const objectURL=new URL(document.location.href),pageurl=objectURL.searchParams.get("url"),pagetitle=objectURL.searchParams.get("title");var cp=1,commentTime=null,emotionTime=null,defaultdata={domain:domain,pageid:pageid,pagetype:pagetype,pageurl:pageurl,pagetitle:pagetitle,commenttype:"",sort:sort,limit:limit};$("#comment-save-btn").on("click",function(t){if($(this).prop("disabled",!0),commentTime&&new Date().getTime()/1e3-commentTime<10)return alert("게시글을 연속해서 작성할 수 없습니다. 잠시 후 다시 시도해주세요."),$(this).prop("disabled",!1),!1;if(""==$.trim($("#content").val()))return alert("내용을 입력해주세요."),$(this).prop("disabled",!1),!1;if($("#content").val().length>1e3)return alert("최대 1,000자 까지만 입력할 수 있습니다."),$(this).prop("disabled",!1),!1;var e=$.extend({},defaultdata);e.content=$("#content").val(),e.commenttype="comment",$.ajax({url:"/api/insert",method:"POST",context:this,data:e,success:function(t){if(!t.success)return alert(t.message),!1;$("#content").val(""),$("#comment-word-count").text("0"),$(".cmt__no-item").remove(),$(".cmt__sort-list a[data-sort=latest]").trigger("click"),commentTime=new Date().getTime()/1e3,action("comment-writing")}}).always(function(){$(this).prop("disabled",!1)})}),$(document).on("click",".cmt__recomm-vote button",function(){if(!userno)return loginview(),!1;if(!0==$(this).closest(".cmt__recomm-vote").data("author")||"true"==$(this).closest(".cmt__recomm-vote").data("author"))return alertview("자신의 게시글은 추천/비추천 할 수  없습니다."),!1;if($(this).closest(".cmt__recomm-vote").find("button").prop("disabled",!0),emotionTime&&new Date().getTime()/1e3-emotionTime<10)return alertview("추천/비추천을 연속해서 할 수 없습니다. 잠시 후 다시 시도해주세요."),$(this).closest(".cmt__recomm-vote").find("button").prop("disabled",!1),!1;var t=$(this).closest(".cmt__recomm-vote").data("uemotion");if(t&&t!=$(this).val())return alertview("이미 추천(비추천) 하였습니다."),$(this).closest(".cmt__recomm-vote").find("button").prop("disabled",!1),!1;var e=$.extend({},defaultdata);e.commentid=$(this).closest(".hk__comment-item").attr("id"),e.commenttype=$(this).closest(".hk__comment-item").data("type"),e.emotion=$(this).val(),e.cuno=$(this).data("userno"),$.ajax({url:"/api/emotion",method:"POST",data:e,context:this,success:function(t){if(!t.success)return alert(t.message),!1;$(this).hasClass("on")?($(this).removeClass("on").find(".cmt__num").text(Number($(this).find(".cmt__num").text())-1),$(this).closest(".cmt__recomm-vote").data("uemotion",""),emotionTime=new Date().getTime()/1e3):($(this).addClass("on").find(".cmt__num").text(Number($(this).find(".cmt__num").text())+1),$(this).closest(".cmt__recomm-vote").data("uemotion",$(this).val()))}}).always(function(){$(this).closest(".cmt__recomm-vote").find("button").prop("disabled",!1)})}),$(document).on("click",".cmt__btn-report",function(){$(this).prop("disabled",!0);var t=$.extend({},defaultdata);if(t.commentid=$(this).data("id"),t.commenttype=$(this).data("type"),t.reason=$(".cmt__report-pop .cmt__pop-cont input[type=radio]:checked").val(),void 0==t.reason)return alertview("신고 사유를 선택해 주세요."),$(this).prop("disabled",!1),!1;$.ajax({url:"/api/report",method:"POST",data:t,context:this,success:function(e){if(!e.success)return alert(e.message),!1;$(".cmt__layer-pop .cmt__btn-pop-close").trigger("click"),$(".cmt__btn-txt.report[data-commentid="+t.commentid+"]").data("check","true"),alertview("신고가 접수되었습니다.")}}).always(function(){$(this).prop("disabled",!1)})}),$(document).on("click",".cmt__btn-txt.delete",function(){if($(this).prop("disabled",!0),!confirm("게시글을 삭제하시겠습니까?"))return $(this).prop("disabled",!1),!1;var t=$.extend({},defaultdata);t.commentid=$(this).data("commentid"),t.commenttype=$(this).closest(".hk__comment-item").data("type"),$.ajax({url:"/api/delete",method:"POST",data:t,context:this,success:function(e){if(!e.success)return alert(e.message),!1;let n=returnCommentElement(e.result);$("#"+e.result._id).replaceWith(n),resize(),action(t.commenttype+"-delete")}}).always(function(){$(this).prop("disabled",!1)})}),$(".cmt__btn-more").on("click",function(){$(this).prop("disabled",!0);var t=$.extend({},defaultdata);t.commenttype="comment",t.p=++cp,$.ajax({url:"/api/list",data:t,context:this,success:function(t){if(!t.success)return alert(t.message),!1;t.result.comments?(createCommentElement(t.result.comments),t.result.isNext||$(".cmt__btn-more").closest(".cmt__btn-area").hide()):(createCommentElement(t.result),t.result.length<limit&&$(".cmt__btn-more").closest(".cmt__btn-area").hide()),resize()}}).always(function(){$(this).prop("disabled",!1)})}),$(".cmt__sort-list a").on("click",function(t){t.preventDefault(),defaultdata.sort=$(this).data("sort");var e=$.extend({},defaultdata);e.commenttype="comment",e.p=1,$(".cmt__sort-list li").removeClass("on"),$(this).closest("li").addClass("on"),$.ajax({url:"/api/refresh-list",data:e,success:function(t){cp=1,$(".cmt__total-num strong").text(t.result.commentCount),$(".hk__comment-list").html(""),createCommentElement(t.result.comments),t.result.length<limit?$(".cmt__btn-more").closest(".cmt__btn-area").hide():$(".cmt__btn-more").closest(".cmt__btn-area").show(),resize()}})}),$(document).on("click",".cmt__reply-area .cmt__btn-reply",function(){if($(this).hasClass("on"))return $(this).removeClass("on"),$("#"+$(this).data("commentid")+"-reply .hk__comment-item").length>1?$(this).find(".cmt__reply-txt").text("열기"):$(this).find(".cmt__reply-txt").text("작성"),$("#"+$(this).data("commentid")+"-reply").remove(),resize(),!1;$(this).addClass("on"),$(this).find(".cmt__reply-txt").text("닫기");var t=$(this).data("commentid"),e=$.extend({},defaultdata);e.commenttype="reply",e.parent=t,$.ajax({url:"/api/list",data:e,context:this,success:function(e){e.result.comments?(e.result.comments.length>0&&$("#"+t+" .cmt__btn-reply .cmt__reply-num").text(e.result.comments.length).show(),createReplyElement(e.result.comments,t)):(e.result.length>0&&$("#"+t+" .cmt__btn-reply .cmt__reply-num").text(e.result.length).show(),createReplyElement(e.result,t)),resize()}})}),$(document).on("click",".hk__comment-list .cmt__btn-upload",function(t){if($(this).prop("disabled",!0),commentTime&&new Date().getTime()/1e3-commentTime<10)return alert("게시글을 연속해서 작성할 수 없습니다. 잠시 후 다시 시도해주세요."),$(this).prop("disabled",!1),!1;var e=$.extend({},defaultdata);return(e.content=$("#"+$(this).data("parentid")+"-reply textarea").val(),e.commenttype="reply",e.parent=$(this).data("parentid"),""==$.trim(e.content))?(alert("내용을 입력해주세요."),$(this).prop("disabled",!1),!1):$("#"+$(this).data("parentid")+"-reply textarea").val().length>1e3?(alert("최대 1,000자 까지만 입력할 수 있습니다."),$(this).prop("disabled",!1),!1):void $.ajax({url:"/api/insert",method:"POST",data:e,context:this,success:function(t){if(!t.success)return alert(t.message),!1;var n=returnCommentElement(t.result);$("#"+e.parent+"-reply > .hk__comment-item:eq(0)").after(n),$("#"+$(this).data("parentid")+"-reply textarea").val(""),$("#"+$(this).data("parentid")+"-reply .cmt__now").text("0");var a=Number($("#"+$(this).data("parentid")+" .cmt__btn-reply .cmt__reply-num").text());$("#"+$(this).data("parentid")+" .cmt__btn-reply .cmt__reply-num").text(a+1).show(),resize(),commentTime=new Date().getTime()/1e3,action("reply-writing")}}).always(function(){$(this).prop("disabled",!1)})}),$(document).on("keyup","textarea",function(){$(this).closest(".hk__comment-inp").find(".cmt__word-count .cmt__now").text($(this).val().length)});var $comment_item_teplate=$('<div class="hk__comment-item"><div class="cmt__user-info"><button type="button" class="cmt__user"><span class="icon-mylogin"><span class="blind"></span></span> <span class="txt"></span></button><div class="cmt__date-tool"><span class="cmt__date"></span><div class="cmt__tool-area"><div class="cmt__recomm-vote"><button type="button" value="like" class="cmt__btn-recomm"><span class="blind">공감</span><em class="cmt__num">0</em></button><button type="button" value="dislike" class="cmt__btn-unrecomm"><span class="blind">비공감</span><em class="cmt__num">0</em></button></div><button type="button" class="cmt__btn-txt report">신고</button><button type="button" class="cmt__btn-txt delete">삭제</button></div></div></div><div class="cmt__txt-box"></div><div class="cmt__reply-area"><button type="button" class="cmt__btn-reply">답글 <span class="cmt__reply-num" style="display: none;">0</span><span class="cmt__reply-txt">열기</span></button></div></div>'),$comment_item_delete_teplate=$('<div class="hk__comment-item delete"><div class="cmt__user-info"><button type="button" class="cmt__user"><span class="icon-mylogin"><span class="blind"></span></span> <span class="txt"></span></button><span class="cmt__date"></span></div><div class="cmt__txt-box"></div><div class="cmt__reply-area"><button type="button" class="cmt__btn-reply">답글 <span class="cmt__reply-num">0</span><span class="cmt__reply-txt">열기</span></button></div></div>'),$reply_wrap_teplate=$('<div class="cmt__reply-wrap cmt__reply-read" id=""><div class="hk__comment-item"><div class="hk__comment-inp"><div class="cmt__user-profile"><p class="cmt__user-email"><span class="icon-mylogin"><span class="blind"></span></span> <span class="txt"></span></p></div><div class="cmt__inp-box"><textarea name="content" cols="30" rows="1" maxlength="1000" placeholder="타인을 배려하는 마음을 담아 게시글을 작성해주세요. 명예훼손, 개인정보 유출, 타인의 권리 침해 등은 이용약관 및 관련 법률에 의해 제재될 수 있습니다."></textarea></div><div class="cmt__upload-area"><div class="cmt__word-count"><span class="cmt__now">0</span> / 1000</div><button class="cmt__btn-upload">등록</button></div><a href="#" class="cmt__login-info">게시글을 작성하려면 로그인을 해주세요.</a></div></div></div>');function returnCommentElement(t){if("CS01"==t.status){var e=$comment_item_teplate.clone();"reply"==t.commentType?e.find(".cmt__reply-area").remove():(e.find(".cmt__btn-reply").data("commentid",t._id),t.childrenCount>0?(e.find(".cmt__btn-reply .cmt__reply-num").text(t.childrenCount).show(),e.find(".cmt__btn-reply .cmt__reply-txt").text("열기")):e.find(".cmt__btn-reply .cmt__reply-txt").text("작성")),e.attr("id",t._id).data("type",t.commentType),e.find(".cmt__user").data("userno",t.userNo),e.find(".cmt__user .txt").text(t.userId),e.find(".cmt__user .icon-mylogin").addClass("icon-mylogin-"+t.userLoginType).removeClass("icon-mylogin"),e.find(".cmt__date").text(t.insertAt),e.find(".cmt__btn-recomm").data("commentid",t._id),e.find(".cmt__btn-unrecomm").data("commentid",t._id),e.find(".cmt__btn-recomm").data("userno",t.userNo),e.find(".cmt__btn-unrecomm").data("userno",t.userNo),e.find(".cmt__btn-recomm .cmt__num").text(t.likeCount),e.find(".cmt__btn-unrecomm .cmt__num").text(t.dislikeCount),e.find(".cmt__txt-box").html(t.content),t.isAuthor?(e.find(".cmt__btn-txt.report").remove(),e.find(".cmt__btn-txt.delete").data("commentid",t._id),e.find(".cmt__recomm-vote").data("author","true")):(e.find(".cmt__btn-txt.delete").remove(),e.find(".cmt__btn-txt.report").data("commentid",t._id),t.ureport&&e.find(".cmt__btn-txt.report").data("check","true")),"like"==t.uemotion?e.find(".cmt__btn-recomm").addClass("on"):"dislike"==t.uemotion&&e.find(".cmt__btn-unrecomm").addClass("on"),t.uemotion&&e.find(".cmt__recomm-vote").data("uemotion",t.uemotion)}else{var e=$comment_item_delete_teplate.clone();"reply"==t.commentType?(e.find(".cmt__reply-area").remove(),e.attr("id",t._id).data("type","reply"),e.find(".cmt__reply-area").remove()):t.childrenCount>0?(e.find(".cmt__btn-reply .cmt__reply-num").text(t.childrenCount).show(),e.find(".cmt__btn-reply").data("commentid",t._id)):e.find(".cmt__reply-area").remove(),e.attr("id",t._id).data("type",t.commentType),e.find(".cmt__user").data("userno",t.userNo),e.find(".cmt__user .txt").text(t.userId),e.find(".cmt__user .icon-mylogin").addClass("icon-mylogin-"+t.userLoginType).removeClass("icon-mylogin"),e.find(".cmt__date").text(t.insertAt),e.find(".cmt__txt-box").html(t.content)}return"event"==pagetype&&e.find(".cmt__reply-area").remove(),e}function createCommentElement(t){$.each(t,function(t,e){if($("#"+e._id).length>0)return!0;var n=returnCommentElement(e);$(".hk__comment-list").append(n)})}function createReplyElement(t,e){var n=$reply_wrap_teplate.clone();if(n.attr("id",e+"-reply"),userno?(n.find(".cmt__login-info").remove(),n.find(".cmt__btn-upload").data("parentid",e),n.find(".cmt__user-email .txt").text(userid),n.find(".cmt__user-email .icon-mylogin").addClass("icon-mylogin-"+userlogintype).removeClass("icon-mylogin")):(n.find(".cmt__user-profile").remove(),n.find(".cmt__inp-box").remove(),n.find(".cmt__upload-area").remove()),$("#"+e).hasClass("delete")&&n.find(".hk__comment-item").remove(),0==t.length)return $("#"+e).after(n),!1;$.each(t,function(t,e){var a=returnCommentElement(e);n.append(a)}),$("#"+e+" .cmt__btn-reply .cmt__reply-num").text(t.length).show(),$("#"+e).after(n)}function loginview(){window.parent.postMessage({type:"commentloginview"},"*")}function alertview(t,e="commentalert"){window.parent.postMessage({type:"commentalertview",msg:t,alertid:e},"*")}function action(t){window.parent.postMessage({type:"user-event",event:t},"*")}function setDeviceClass(){/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?($("html").addClass("isM"),"true"==objectURL.searchParams.get("lightmode")&&$("html").addClass("isLight")):$("html").addClass("isPC")}function setTheme(){$("body").removeClass("theme-sepia theme-light theme-dark"),$.cookie("cleanViewTheme")?$("body").addClass($.cookie("cleanViewTheme")):$("body").addClass("theme-light")}$(".cmt__btn-policy").on("click",function(){window.parent.postMessage({type:"policy"},"*")}),$(".hk__comment-wrap").on("click","a.cmt__login-info",function(t){t.preventDefault(),loginview()}),$(document).on("click",".cmt__btn-txt.report",function(){if(!userno)return loginview(),!1;if($(this).data("check"))return alertview("이미 신고한 게시글입니다."),!1;var t=document.querySelector(".hk__comment-wrap").scrollHeight,e=$(this).offset().top;t<=550?$(".cmt__layer-wrap.cmt__report-pop .cmt__layer-pop").css("top","50%"):t>550&&e<500?$(".cmt__layer-wrap.cmt__report-pop .cmt__layer-pop").css("top","255px"):250<t-e?$(".cmt__layer-wrap.cmt__report-pop .cmt__layer-pop").css("top",e+"px"):t>550?$(".cmt__layer-wrap.cmt__report-pop .cmt__layer-pop").css("top",e-200+"px"):$(".cmt__layer-wrap.cmt__report-pop .cmt__layer-pop").css("top","50%"),$(".cmt__btn-report").data("id",$(this).data("commentid")).data("type",$(this).closest(".hk__comment-item").data("type")),$(".cmt__layer-wrap.cmt__report-pop").addClass("active"),$("body").addClass("notScroll")}),$(document).on("click",".cmt__user, .cmt__btn-mycmt",function(){window.parent.postMessage({type:"userlist",userno:$(this).data("userno")},"*")}),$(".cmt__layer-pop .cmt__btn-pop-close").on("click",function(){$(".cmt__btn-report").data("id","").data("type",""),$(".cmt__report-pop .cmt__pop-cont input[type=radio]:checked").prop("checked",!1),$(this).parents(".cmt__layer-wrap, .cmt__layer-collect-wrap").removeClass("active"),$("body").removeClass("notScroll")}),$(".cmt__layer-wrap").on("click",function(t){$(t.target).hasClass("cmt__layer-wrap")&&$(t.target).find(".cmt__btn-pop-close").trigger("click")}),window.addEventListener("message",t=>{var e;if(0>t.origin.indexOf(".hankyung.com"))return!1;"setTheme"===t.data.type&&setTheme()},!1),setDeviceClass(),theme&&setTheme(),$(function(){resize()}),$(window).on("load",function(){resize()});